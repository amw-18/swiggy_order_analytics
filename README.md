# Mbox Food Order Segregator

This project contains Python scripts designed to parse Google Takeout (`.mbox`) email exports, extract specific Swiggy and Instamart food orders, and segregate them intelligently into an easy-to-explore directory structure. The scripts act on the emails by reading the parsed DOMs and PDF tax invoice attachments to collect precise expenditure analytics over time.

## Requirements

- Python 3.9+
- `uv` package manager (or `pip`)

## Installation

Ensure you have your virtual environment activated:
```bash
# If using a custom alias like dovenv
dovenv
```

Install the dependencies:
```bash
uv pip install beautifulsoup4 pypdf
```

## Usage

1. **Place your Mbox Export:** Ensure you have an `export.mbox` file located in the root directory. This mbox file should contain your email exports.
2. **Execute the Segregation Script:**

```bash
python process_mbox.py
```

This script will:
- Iterate through all emails in `export.mbox`.
- Filter out only the emails with subjects starting with "Your swiggy order", "Your swiggy gourmet order", or "Your instamart order".
- Parse the delivery address to group related orders.
- Segregate emails into nested folders based on the delivery Address and Date.
- Extract any `.pdf` attachments.
- Securely parse the exact invoice amount (`Invoice Total` or `Invoice Value`) using `pypdf`. 
- Generate analytics and `summary.json` representations indicating daily, monthly, and aggregate expenditures.

3. **Merge Monthly PDFs (Optional):**
If you want to view a consolidated layout of your invoices, you can compile all the PDFs using the merge helper:

```bash
python merge_pdfs.py
```
This utility walks through your segregated address directories, groups the invoices by `YYYY-MM`, and concatenates them into a master `merged_YYYY-MM.pdf` document.

## Directory Structure

Running the pipeline will produce a `segregated_orders/` directoy shaped like this:

```
segregated_orders/
│
├── folder_address.json           # Maps "address1" to your actual lengthy delivery address string.
├── address1/
│   ├── summary.json              # Aggregate breakdown & monthly totals JSON format
│   ├── summary.md                # Human-readable aggregate markdown file
│   ├── merged_2025-11.pdf        # Concatenated master PDF (generated by merge_pdfs.py)
│   ├── 20251102/
│   │   ├── 1.eml                 # Raw extracted email bytes.
│   │   ├── 2.eml
│   │   ├── eml1attach1.pdf       # The corresponding PDF tax invoice.
│   │   ├── eml2attach1.pdf
│   │   └── summary.json          # Daily expenditure specific to this date.
```

## Files

- `process_mbox.py`: Main processing script that handles the parsing of the DOM/PDFs and structural movement.
- `merge_pdfs.py`: Helper script to unify multiple PDF invoices into monthly aggregations.
